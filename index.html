<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calmify AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ---------- BASE ---------- */
body {
  margin: 0;
  font-family: "Segoe UI", "Helvetica Neue", sans-serif;
  background: #ffffff;
  color: #1f2937;
  overflow-x: hidden;
}

/* ---------- AURORA ---------- */
.aurora {
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 30% 30%, rgba(147,197,253,0.25), transparent 60%),
    radial-gradient(circle at 70% 60%, rgba(196,181,253,0.25), transparent 60%);
  animation: auroraMove 25s ease-in-out infinite;
  z-index: -1;
}
@keyframes auroraMove {
  0%, 100% { filter: hue-rotate(0deg); }
  50% { filter: hue-rotate(20deg); }
}

/* ---------- LAYOUT ---------- */
.screen {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
}

.container {
  max-width: 1100px;
  width: 100%;
  padding: 40px;
  display: flex;
  gap: 50px;
  align-items: flex-start;
  justify-content: center;
}

/* ---------- BUDDY ---------- */
.buddy {
  width: 220px;
  text-align: center;
}

.buddy-face {
  width: 160px;
  height: 160px;
  margin: auto;
  border-radius: 50%;
  background: linear-gradient(#fefefe, #e5e7eb);
  box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  animation: float 4s ease-in-out infinite;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

@keyframes float {
  0%,100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.buddy-eyes {
  display: flex;
  justify-content: space-between;
  width: 50%;
  margin-top: 20px;
}

.eye {
  width: 14px;
  height: 14px;
  background: #111827;
  border-radius: 50%;
}

.buddy-mouth {
  width: 40px;
  height: 12px;
  border-bottom: 3px solid #111827;
  border-radius: 0 0 30px 30px;
  margin-top: 20px;
}

.buddy-hint {
  margin-top: 12px;
  font-size: 14px;
  opacity: 0.6;
}

/* ---------- BOOK ---------- */
.book {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

h1 {
  font-weight: 600;
  margin-bottom: 10px;
  font-size: 32px;
  color: #1e40af;
}

.controls {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

select, button {
  padding: 10px 16px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  background: #f9fafb;
  cursor: pointer;
  font-size: 14px;
}

button.primary {
  background: #2563eb;
  color: white;
  border: none;
  font-weight: 600;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

button.primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,0.15);
}

.book-text {
  font-size: 20px;
  line-height: 1.8;
  white-space: pre-wrap;
  background: #ffffff;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 15px 30px rgba(0,0,0,0.08);
  min-height: 350px;
  transition: background 0.3s;
}

/* ---------- NAV ---------- */
.nav {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}

.nav button {
  flex: 1;
  margin: 0 5px;
  background: #34d399;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 10px 0;
  font-weight: 600;
  transition: transform 0.2s;
}

.nav button:hover {
  transform: translateY(-2px);
}

</style>
</head>

<body>
<div class="aurora"></div>

<div class="screen">
  <div class="container">

    <!-- BUDDY -->
    <div class="buddy">
      <div class="buddy-face" onclick="petBuddy()">
        <div class="buddy-eyes">
          <span class="eye"></span>
          <span class="eye"></span>
        </div>
        <div class="buddy-mouth"></div>
      </div>
      <div class="buddy-hint">Click to pet me</div>
    </div>

    <!-- BOOK -->
    <div class="book">
      <h1>Calmify</h1>

      <div class="controls">
        <select onchange="selectedVoiceIndex = Number(this.value)">
          <option value="0">Soft Female</option>
          <option value="1">Warm Female</option>
          <option value="2">Calm Male</option>
          <option value="3">Neutral</option>
        </select>

        <select onchange="readMode = this.value">
          <option value="buddy">Buddy reads</option>
          <option value="silent">I'll read</option>
        </select>

        <button class="primary" onclick="startSession()">Start session</button>
      </div>

      <div id="bookText" class="book-text">
        Press “Start session” to begin your calming book.
      </div>

      <div class="nav">
        <button onclick="prevPage()">Previous</button>
        <button onclick="nextPage()">Next</button>
      </div>
    </div>

  </div>
</div>

<script>
/* ---------- AI BLUEPRINT ---------- */
function generateBlueprint(){
  const emotions=[
    ["overwhelmed","slowing","grounded","safe","peaceful"],
    ["tense","softening","steady","relaxed","secure"]
  ];
  const themes=["white skies","quiet light","soft mornings","open space"];

  return {
    theme: themes[Math.floor(Math.random()*themes.length)],
    emotion_arc: emotions[Math.floor(Math.random()*emotions.length)],
    chapters:["Arriving","Letting go","Breathing space","Settling","Rest"],
    vocabulary:{
      nouns:["air","light","space","warmth","stillness"],
      verbs:["drifting","softening","settling","floating","resting"],
      adjectives:["gentle","quiet","safe","steady","calm"]
    }
  };
}

/* ---------- BOOK EXPANSION ---------- */
let blueprint, pages=[], pageIndex=0;
let readMode="buddy", selectedVoiceIndex=0;

function buildBook(bp){
  const out=[];
  bp.chapters.forEach((ch,i)=>{
    for(let p=0;p<4;p++){
      out.push(`
${ch}

You may notice yourself ${pick(bp.vocabulary.verbs)}.
The ${pick(bp.vocabulary.nouns)} feels ${pick(bp.vocabulary.adjectives)}.
Nothing needs your attention right now.
You are allowed to take your time.
      `.trim());
    }
  });
  return out;
}

function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}

/* ---------- SESSION ---------- */
function startSession(){
  blueprint=generateBlueprint();
  pages=buildBook(blueprint);
  pageIndex=0;
  showPage();
  buddySpeak("I'm here with you. We can go slowly.");
}

/* ---------- DISPLAY ---------- */
function showPage(){
  const text=pages[pageIndex];
  document.getElementById("bookText").textContent=text;

  if(readMode==="buddy"){
    if(pageIndex===0) buddySpeak("Let's start our calming journey together.");
    else if(pageIndex===pages.length-1) buddySpeak("Well done! You’re safe and calm.");
    else buddySpeak("Take your time reading this part quietly.");
  }
}

function nextPage(){ if(pageIndex<pages.length-1){pageIndex++; showPage();}}
function prevPage(){ if(pageIndex>0){pageIndex--; showPage();}}

/* ---------- ENHANCED VOICE ---------- */
function getBestVoice() {
  const voices=speechSynthesis.getVoices();
  return voices.find(v=> /natural|neural|samantha|aria|alloy/i.test(v.name))||voices[0];
}

function speakNatural(text){
  if(readMode!=="buddy") return;
  speechSynthesis.cancel();

  const voice=getBestVoice();
  const sentences=text.match(/[^.!?]+[.!?]+|[^.!?]+$/g);
  if(!sentences) return;

  sentences.forEach((s,i)=>{
    setTimeout(()=>{
      const u=new SpeechSynthesisUtterance(s.trim());
      u.voice=voice;
      u.rate=0.85;
      u.pitch=1.0;
      u.volume=0.9;
      speechSynthesis.speak(u);
    }, i*1200);
  });
}

function buddySpeak(text){ speakNatural(text); }

/* ---------- BUDDY INTERACTIONS ---------- */
function petBuddy(){ buddySpeak("That feels nice. You're doing really well."); }

</script>
</body>
</html>
